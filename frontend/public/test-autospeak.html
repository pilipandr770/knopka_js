<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç AutoSpeak - Voice Widget</title>
    <link rel="stylesheet" href="widget-animated.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        
        .test-btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }
        
        .status {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîä –¢–µ—Å—Ç AutoSpeak</h1>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ–∑–≤—É—á–∫—É –æ—Ç–≤–µ—Ç–æ–≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</p>
        
        <div class="status" id="status">
            üí° –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∏–¥–∂–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ–∑–≤—É—á–∫–∏
        </div>
        
        <div>
            <button class="test-btn" onclick="testShortMessage()">üìù –ö–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
            <button class="test-btn" onclick="testLongMessage()">üìÑ –î–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</button>
            <button class="test-btn" onclick="testAutoSpeakToggle()">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å AutoSpeak</button>
            <button class="test-btn" onclick="checkWidgetState()">üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ</button>
        </div>
        
        <div class="log" id="log">
            <div>üöÄ –¢–µ—Å—Ç AutoSpeak –∑–∞–≥—Ä—É–∂–µ–Ω</div>
        </div>
    </div>

    <!-- Voice Widget Scripts -->
    <script src="utils.js"></script>
    <script src="api-client.js"></script>
    <script src="voice-recognition.js"></script>
    <script src="voice-synthesis.js"></script>
    <script src="voice-widget.js"></script>

    <script>
        let widget;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞
        try {
            widget = new VoiceWidget({
                debug: true,
                autoSpeak: true,
                preferOpenAITTS: false,
                autoInit: true
            });
            
            log('‚úÖ –í–∏–¥–∂–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å autoSpeak: true');
        } catch (error) {
            log('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message);
        }
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.innerHTML = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }
        
        async function testShortMessage() {
            if (!widget) {
                log('‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            updateStatus('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...');
            log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
            
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞
                if (!widget.isOpen) {
                    widget.togglePanel();
                }
                
                // –≠–º—É–ª–∏—Ä—É–µ–º –≤–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è
                widget.elements.input.value = '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?';
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                await widget.handleSendMessage();
                
                log('‚úÖ –ö–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º autoSpeak...');
                updateStatus('‚úÖ –ö–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –°–ª—É—à–∞–π—Ç–µ –æ–∑–≤—É—á–∫—É...');
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }
        
        async function testLongMessage() {
            if (!widget) {
                log('‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            updateStatus('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...');
            log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
            
            try {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞
                if (!widget.isOpen) {
                    widget.togglePanel();
                }
                
                // –≠–º—É–ª–∏—Ä—É–µ–º –≤–≤–æ–¥ –¥–ª–∏–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                widget.elements.input.value = '–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–æ –æ —Ç–æ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ –∏ –∫–∞–∫–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤';
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                await widget.handleSendMessage();
                
                log('‚úÖ –î–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, –ø—Ä–æ–≤–µ—Ä—è–µ–º TTS API...');
                updateStatus('‚úÖ –î–ª–∏–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –°–ª—É—à–∞–π—Ç–µ –æ–∑–≤—É—á–∫—É —á–µ—Ä–µ–∑ TTS API...');
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message);
                updateStatus('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }
        
        function testAutoSpeakToggle() {
            if (!widget) {
                log('‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º autoSpeak
            widget.options.autoSpeak = !widget.options.autoSpeak;
            
            const status = widget.options.autoSpeak ? '–≤–∫–ª—é—á–µ–Ω' : '–≤—ã–∫–ª—é—á–µ–Ω';
            log(`üîÑ AutoSpeak ${status}`);
            updateStatus(`üîÑ AutoSpeak ${status}`);
        }
        
        function checkWidgetState() {
            if (!widget) {
                log('‚ùå –í–∏–¥–∂–µ—Ç –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return;
            }
            
            const state = {
                autoSpeak: widget.options.autoSpeak,
                isOpen: widget.isOpen,
                isRecording: widget.isRecording,
                isSpeaking: widget.isSpeaking,
                isInitialized: widget.isInitialized
            };
            
            log('üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞:');
            Object.entries(state).forEach(([key, value]) => {
                log(`   ${key}: ${value}`);
            });
            
            updateStatus('üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ –≤—ã–≤–µ–¥–µ–Ω–æ –≤ –ª–æ–≥');
        }
        
        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π —Ä–µ—á–∏
        if (widget && widget.voiceSynthesis) {
            const originalOnStart = widget.voiceSynthesis.onStart;
            const originalOnEnd = widget.voiceSynthesis.onEnd;
            
            widget.voiceSynthesis.onStart = function() {
                log('üéµ VoiceSynthesis: onStart –≤—ã–∑–≤–∞–Ω');
                originalOnStart.call(this);
            };
            
            widget.voiceSynthesis.onEnd = function() {
                log('üéµ VoiceSynthesis: onEnd –≤—ã–∑–≤–∞–Ω');
                originalOnEnd.call(this);
            };
        }
        
        log('üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    </script>
</body>
</html>
