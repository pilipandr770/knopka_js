<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Widget - –ü–æ–ª–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="widget.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hero {
            text-align: center;
            padding: 60px 0;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto 40px;
        }
        
        .status-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .status-badge.success {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 60px 0;
        }
        
        .feature-card {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #fff;
        }
        
        .feature-card p {
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 5px 0;
            opacity: 0.8;
        }
        
        .feature-list li:before {
            content: "‚úì ";
            color: #4CAF50;
            font-weight: bold;
        }
        
        .demo-section {
            background: rgba(255,255,255,0.1);
            padding: 50px;
            border-radius: 25px;
            margin: 40px 0;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .control-group {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: left;
        }
        
        .control-group label {
            display: flex;
            align-items: center;
            font-weight: 600;
            cursor: pointer;
        }
        
        .control-group input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn.secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }
        
        .status-display {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .status-display.success {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .status-display.error {
            background: rgba(244, 67, 54, 0.3);
        }
        
        .status-display.warning {
            background: rgba(255, 152, 0, 0.3);
        }
        
        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            margin: 40px 0;
        }
        
        .instructions h3 {
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .instructions ol {
            text-align: left;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .instructions li {
            margin: 10px 0;
            padding: 10px 0;
            opacity: 0.9;
        }
        
        .technical-info {
            background: rgba(0,0,0,0.2);
            padding: 30px;
            border-radius: 15px;
            margin: 40px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .widget-preview {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .feature-card {
                padding: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üéôÔ∏è Voice Widget</h1>
            <p>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–∑–≤—É—á–∫–æ–π –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –±–∞–∑–µ OpenAI</p>
            <div class="status-badge success">
                ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
            </div>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-icon">üîä</span>
                <h3>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–∑–≤—É—á–∫–∞</h3>
                <p>–í—Å–µ –æ—Ç–≤–µ—Ç—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∑–≤—É—á–∏–≤–∞—é—Ç—Å—è —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</p>
                <ul class="feature-list">
                    <li>OpenAI TTS –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤</li>
                    <li>–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ñ—Ä–∞–∑</li>
                    <li>–°–∏—Å—Ç–µ–º–∞ fallback –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏</li>
                    <li>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</li>
                </ul>
            </div>

            <div class="feature-card">
                <span class="feature-icon">üéØ</span>
                <h3>–£–º–Ω—ã–π –≤–≤–æ–¥</h3>
                <p>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π</p>
                <ul class="feature-list">
                    <li>–ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</li>
                    <li>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–µ—á–∏ –≤ —Ç–µ–∫—Å—Ç</li>
                    <li>–û–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞</li>
                    <li>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–∞–º—è—Ç—å –¥–∏–∞–ª–æ–≥–∞</li>
                </ul>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ü§ñ</span>
                <h3>OpenAI Integration</h3>
                <p>–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI Assistant API –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞</p>
                <ul class="feature-list">
                    <li>GPT-4 –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤</li>
                    <li>Whisper –¥–ª—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏</li>
                    <li>TTS-1 –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏</li>
                    <li>–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Ç—Ä–µ–¥—ã –¥–∏–∞–ª–æ–≥–æ–≤</li>
                </ul>
            </div>

            <div class="feature-card">
                <span class="feature-icon">‚ö°</span>
                <h3>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                <p>–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏</p>
                <ul class="feature-list">
                    <li>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤</li>
                    <li>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</li>
                    <li>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤</li>
                    <li>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</li>
                </ul>
            </div>

            <div class="feature-card">
                <span class="feature-icon">üõ°Ô∏è</span>
                <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                <p>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                <ul class="feature-list">
                    <li>CORS –∑–∞—â–∏—Ç–∞</li>
                    <li>Rate limiting</li>
                    <li>–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</li>
                    <li>–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤</li>
                </ul>
            </div>

            <div class="feature-card">
                <span class="feature-icon">üé®</span>
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∞</h3>
                <p>–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</p>
                <ul class="feature-list">
                    <li>–¢–µ–º—ã –∏ —Å—Ç–∏–ª–∏</li>
                    <li>–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞</li>
                    <li>–Ø–∑—ã–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</li>
                    <li>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–∞</li>
                </ul>
            </div>
        </div>

        <div class="demo-section">
            <h2>üöÄ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è</h2>
            
            <div class="controls">
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="autoSpeakToggle" checked>
                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
                    </label>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="debugToggle">
                        –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏)
                    </label>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="preferOpenAITTS">
                        –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç—å OpenAI TTS
                    </label>
                </div>
            </div>

            <div class="buttons">
                <button class="btn" onclick="initializeWidget()">
                    üéâ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–∂–µ—Ç
                </button>
                <button class="btn secondary" onclick="testAutoSpeech()">
                    üîä –¢–µ—Å—Ç –∞–≤—Ç–æ–æ–∑–≤—É—á–∫–∏
                </button>
                <button class="btn secondary" onclick="testBrowserTTS()">
                    üåê –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS
                </button>
                <button class="btn secondary" onclick="testOpenAITTS()">
                    ü§ñ OpenAI TTS
                </button>
                <button class="btn warning" onclick="runFullTest()">
                    üß™ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
                </button>
            </div>

            <div id="status" class="status-display">
                –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–∂–µ—Ç", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é
            </div>
        </div>

        <div class="instructions">
            <h3>üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</h3>
            <ol>
                <li><strong>–ó–∞–ø—É—Å–∫ –≤–∏–¥–∂–µ—Ç–∞:</strong> –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏–¥–∂–µ—Ç" –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</li>
                <li><strong>–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∂–µ—Ç–∞ –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏ —á–∞—Ç–∞</li>
                <li><strong>–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥:</strong> –£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</li>
                <li><strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–∑–≤—É—á–∫–∞:</strong> –í—Å–µ –æ—Ç–≤–µ—Ç—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∑–≤—É—á–µ–Ω—ã</li>
                <li><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–µ–∫–±–æ–∫—Å—ã –≤—ã—à–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞</li>
                <li><strong>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</li>
                <li><strong>–û—Ç–ª–∞–¥–∫–∞:</strong> –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞</li>
            </ol>
        </div>

        <div class="technical-info">
            <h3>üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            <p><strong>Backend:</strong> Node.js + Express</p>
            <p><strong>Frontend:</strong> Vanilla JavaScript (ES6+)</p>
            <p><strong>AI:</strong> OpenAI GPT-4, Whisper, TTS-1</p>
            <p><strong>–ê—É–¥–∏–æ:</strong> Web Audio API, Speech Recognition/Synthesis</p>
            <p><strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong> CORS, Rate Limiting, Input Validation</p>
            <p><strong>–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:</strong> Docker, Render.com ready</p>
        </div>
    </div>

    <!-- Widget scripts -->
    <script src="/utils.js"></script>
    <script src="/api-client.js"></script>
    <script src="/voice-recognition.js"></script>
    <script src="/voice-synthesis.js"></script>
    <script src="/voice-widget.js"></script>

    <script>
        let widget = null;
        let testResults = {
            widget: false,
            autoSpeech: false,
            browserTTS: false,
            openaiTTS: false
        };
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status-display ${type}`;
            console.log(`[Demo] ${message}`);
        }

        function initializeWidget() {
            const autoSpeak = document.getElementById('autoSpeakToggle').checked;
            const debug = document.getElementById('debugToggle').checked;
            const preferOpenAITTS = document.getElementById('preferOpenAITTS').checked;
            
            updateStatus('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞...', 'info');
            
            try {
                widget = new window.VoiceWidget({
                    debug: debug,
                    autoSpeak: autoSpeak,
                    preferOpenAITTS: preferOpenAITTS,
                    autoInit: true
                });
                
                testResults.widget = true;
                updateStatus('‚úÖ –í–∏–¥–∂–µ—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –≤ –ø—Ä–∞–≤–æ–º –Ω–∏–∂–Ω–µ–º —É–≥–ª—É.', 'success');
                
            } catch (error) {
                testResults.widget = false;
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        async function testAutoSpeech() {
            if (!widget) {
                updateStatus('‚ùå –°–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤–∏–¥–∂–µ—Ç', 'error');
                return;
            }

            updateStatus('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–∑–≤—É—á–∫–∏...', 'info');
            
            try {
                const testMessage = '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–∑–≤—É—á–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!';
                
                if (widget.options.autoSpeak) {
                    await widget.speakAssistantResponse(testMessage);
                    testResults.autoSpeech = true;
                    updateStatus('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–∑–≤—É—á–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                } else {
                    updateStatus('‚ö†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–∑–≤—É—á–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö', 'warning');
                }
                
            } catch (error) {
                testResults.autoSpeech = false;
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–æ–∑–≤—É—á–∫–∏: ${error.message}`, 'error');
            }
        }

        async function testBrowserTTS() {
            updateStatus('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ TTS...', 'info');
            
            if (!('speechSynthesis' in window)) {
                testResults.browserTTS = false;
                updateStatus('‚ùå –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
                return;
            }
            
            try {
                const utterance = new SpeechSynthesisUtterance('–¢–µ—Å—Ç –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                utterance.lang = 'ru-RU';
                
                utterance.onstart = () => updateStatus('üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS...', 'info');
                utterance.onend = () => {
                    testResults.browserTTS = true;
                    updateStatus('‚úÖ –ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π TTS —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                };
                utterance.onerror = (error) => {
                    testResults.browserTTS = false;
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ TTS: ${error.error}`, 'error');
                };
                
                speechSynthesis.speak(utterance);
                
            } catch (error) {
                testResults.browserTTS = false;
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ TTS: ${error.message}`, 'error');
            }
        }

        async function testOpenAITTS() {
            updateStatus('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenAI TTS...', 'info');
            
            try {
                const response = await fetch('/api/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: '–¢–µ—Å—Ç OpenAI —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const audio = document.createElement('audio');
                    audio.src = `data:audio/mp3;base64,${data.data.audio}`;
                    
                    audio.onplay = () => updateStatus('üîä –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è OpenAI TTS...', 'info');
                    audio.onended = () => {
                        testResults.openaiTTS = true;
                        updateStatus('‚úÖ OpenAI TTS —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ', 'success');
                    };
                    audio.onerror = () => {
                        testResults.openaiTTS = false;
                        updateStatus('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è OpenAI TTS', 'error');
                    };
                    
                    await audio.play();
                } else {
                    testResults.openaiTTS = false;
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞ OpenAI TTS API: ${data.error}`, 'error');
                }
                
            } catch (error) {
                testResults.openaiTTS = false;
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ OpenAI TTS: ${error.message}`, 'error');
            }
        }

        async function runFullTest() {
            updateStatus('üîÑ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...', 'info');
            
            // Reset results
            testResults = {
                widget: false,
                autoSpeech: false,
                browserTTS: false,
                openaiTTS: false
            };
            
            try {
                // Test 1: Widget initialization
                initializeWidget();
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Test 2: Browser TTS
                await testBrowserTTS();
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Test 3: OpenAI TTS
                await testOpenAITTS();
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Test 4: Auto speech
                await testAutoSpeech();
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                // Summary
                const passed = Object.values(testResults).filter(Boolean).length;
                const total = Object.keys(testResults).length;
                
                if (passed === total) {
                    updateStatus(`üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! (${passed}/${total})`, 'success');
                } else {
                    updateStatus(`‚ö†Ô∏è –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${passed}/${total}`, 'warning');
                }
                
            } catch (error) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // Auto-initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('üì± –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!', 'success');
            
            // Initialize widget automatically
            setTimeout(() => {
                initializeWidget();
            }, 1000);
        });

        // Add visual feedback for successful operations
        function showSuccessEffect() {
            const effect = document.createElement('div');
            effect.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 4rem;
                z-index: 10000;
                pointer-events: none;
                animation: successPulse 1s ease-out;
            `;
            effect.textContent = '‚úÖ';
            document.body.appendChild(effect);
            
            setTimeout(() => {
                document.body.removeChild(effect);
            }, 1000);
        }

        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes successPulse {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
                50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
